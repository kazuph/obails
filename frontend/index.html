<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Obails</title>
    <link rel="stylesheet" href="/src/styles/main.css"/>
</head>
<body>
    <div id="app">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Obails</h2>
                <button id="settings-btn" title="Settings (‚åò,)">‚öô</button>
            </div>
            <div class="file-search">
                <input type="text" id="file-search-input" placeholder="Search files..." autocomplete="off">
                <button id="file-search-clear" class="search-clear-btn" style="display: none;">‚úï</button>
            </div>
            <div class="file-tree" id="file-tree">
                <!-- File tree will be rendered here -->
            </div>
        </div>
        <div class="resize-handle" id="sidebar-resize"></div>

        <div class="main-content">
            <div class="toolbar">
                <button id="new-note-btn" title="New Note (‚åòN)">‚úèÔ∏è</button>
                <button id="daily-note-btn" title="Today's Daily Note">üìÖ</button>
                <button id="timeline-btn" title="Timeline">üí≠</button>
                <button id="graph-btn" title="Graph View (‚åòG)">üï∏Ô∏è</button>
                <button id="refresh-btn" title="Refresh">üîÑ</button>
                <div class="toolbar-spacer"></div>
                <div class="theme-selector">
                    <label>Theme:</label>
                    <select id="theme-select">
                        <optgroup label="Light">
                            <option value="github-light">GitHub Light</option>
                            <option value="solarized-light">Solarized Light</option>
                            <option value="one-light">One Light</option>
                            <option value="catppuccin-latte">Catppuccin Latte</option>
                            <option value="rosepine-dawn">Ros√© Pine Dawn</option>
                        </optgroup>
                        <optgroup label="Dark">
                            <option value="catppuccin">Catppuccin Mocha</option>
                            <option value="dracula">Dracula</option>
                            <option value="nord">Nord</option>
                            <option value="solarized">Solarized Dark</option>
                            <option value="onedark">One Dark</option>
                            <option value="gruvbox">Gruvbox</option>
                            <option value="tokyonight">Tokyo Night</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <!-- New Note Input Form -->
            <div class="new-note-form" id="new-note-form" style="display: none;">
                <div class="new-note-input-container">
                    <span class="new-note-icon">üìÑ</span>
                    <input type="text" id="new-note-input" placeholder="Enter filename (without .md)" autocomplete="off">
                    <span class="new-note-extension">.md</span>
                    <button id="new-note-create" class="new-note-btn create">Create</button>
                    <button id="new-note-cancel" class="new-note-btn cancel">Cancel</button>
                </div>
            </div>

            <div class="editor-container">
                <div class="editor-pane" id="editor-pane">
                    <div class="pane-header" id="editor-header">
                        <span class="pane-title" id="editor-title">Select a note...</span>
                    </div>
                    <textarea id="editor" placeholder="Select a note..."></textarea>
                </div>
                <div class="resize-handle vertical" id="editor-resize"></div>
                <div class="preview-pane" id="preview-pane">
                    <div class="pane-header" id="preview-header">
                        <span class="pane-title" id="preview-title">Preview</span>
                    </div>
                    <div id="preview"></div>
                </div>
            </div>

            <div class="timeline-panel" id="timeline-panel" style="display: none;">
                <div class="timeline-input">
                    <textarea id="timeline-input" placeholder="What's on your mind?"></textarea>
                    <button id="timeline-submit">Post</button>
                </div>
                <div class="timeline-list" id="timeline-list">
                    <!-- Timeline entries will be rendered here -->
                </div>
            </div>

            <!-- Image Viewer -->
            <div class="image-viewer" id="image-viewer" style="display: none;">
                <div class="pane-header">
                    <span class="pane-title" id="image-title">Image</span>
                    <div class="image-controls">
                        <button id="image-fullscreen" title="Fullscreen">‚§¢</button>
                    </div>
                </div>
                <div class="image-container" id="image-container">
                    <img id="image-preview" alt="Preview" />
                </div>
            </div>

            <!-- PDF Viewer -->
            <div class="pdf-viewer" id="pdf-viewer" style="display: none;">
                <div class="pane-header">
                    <span class="pane-title" id="pdf-title">PDF</span>
                    <div class="pdf-controls">
                        <button id="pdf-view-mode" title="Toggle View Mode (Single/Continuous)">üìÑ</button>
                        <button id="pdf-prev" title="Previous Page">‚óÄ</button>
                        <span id="pdf-page-info">1 / 1</span>
                        <button id="pdf-next" title="Next Page">‚ñ∂</button>
                        <button id="pdf-zoom-out" title="Zoom Out">‚àí</button>
                        <span id="pdf-zoom-info">100%</span>
                        <button id="pdf-zoom-in" title="Zoom In">+</button>
                        <button id="pdf-fullscreen" title="Fullscreen">‚¨ú</button>
                    </div>
                </div>
                <div class="pdf-container-wrapper" id="pdf-container-wrapper">
                    <div class="pdf-container pdf-buffer-active" id="pdf-container-a"></div>
                    <div class="pdf-container pdf-buffer-back" id="pdf-container-b"></div>
                </div>
            </div>

            <!-- HTML Editor -->
            <div class="html-editor-container" id="html-editor-container" style="display: none;">
                <div class="editor-pane" id="html-editor-pane">
                    <div class="pane-header">
                        <span class="pane-title" id="html-editor-title">HTML</span>
                    </div>
                    <textarea id="html-editor" placeholder="HTML content..."></textarea>
                </div>
                <div class="resize-handle vertical" id="html-editor-resize"></div>
                <div class="preview-pane" id="html-preview-pane">
                    <div class="pane-header">
                        <span class="pane-title">Preview</span>
                    </div>
                    <iframe id="html-preview" sandbox="allow-same-origin" title="HTML Preview"></iframe>
                </div>
            </div>
        </div>

        <div class="right-sidebar" id="right-sidebar">
            <div class="outline-panel" id="outline-panel">
                <h3>Outline</h3>
                <div id="outline-list">
                    <!-- Outline will be rendered here -->
                </div>
            </div>
            <div class="resize-handle horizontal" id="outline-resize"></div>
            <div class="outgoing-links-panel" id="outgoing-links-panel">
                <h3>Outgoing Links</h3>
                <div id="outgoing-links-list">
                    <!-- Outgoing links will be rendered here -->
                </div>
            </div>
            <div class="resize-handle horizontal" id="outgoing-resize"></div>
            <div class="backlinks-panel" id="backlinks-panel">
                <h3>Backlinks</h3>
                <div id="backlinks-list">
                    <!-- Backlinks will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Fullscreen Overlay -->
    <div class="image-fullscreen" id="image-fullscreen-overlay" style="display: none;">
        <div class="image-fs-header">
            <span class="image-fs-title" id="image-fs-title">Image</span>
            <button id="image-fs-close" title="Close (ESC)">‚úï</button>
        </div>
        <div class="image-fs-content">
            <img id="image-fs-preview" alt="Fullscreen Preview" />
        </div>
    </div>

    <!-- PDF Fullscreen Overlay -->
    <div class="pdf-fullscreen" id="pdf-fullscreen-overlay" style="display: none;">
        <div class="pdf-fs-header">
            <span class="pdf-fs-title" id="pdf-fs-title">PDF</span>
            <div class="pdf-fs-controls">
                <button id="pdf-fs-view-mode" title="Toggle View Mode">üìÑ</button>
                <button id="pdf-fs-prev" title="Previous Page">‚óÄ</button>
                <span id="pdf-fs-page-info">1 / 1</span>
                <button id="pdf-fs-next" title="Next Page">‚ñ∂</button>
                <button id="pdf-fs-zoom-out" title="Zoom Out">‚àí</button>
                <span id="pdf-fs-zoom-info">100%</span>
                <button id="pdf-fs-zoom-in" title="Zoom In">+</button>
                <button id="pdf-fs-close" title="Close (ESC)">‚úï</button>
            </div>
        </div>
        <div class="pdf-fs-container" id="pdf-fs-container">
            <!-- Canvas elements will be added dynamically -->
        </div>
    </div>

    <!-- Mermaid Fullscreen Overlay -->
    <div class="mermaid-fullscreen" id="mermaid-fullscreen">
        <div class="mermaid-fs-header">
            <h3>Mermaid Diagram</h3>
            <div class="mermaid-fs-controls">
                <button id="mermaid-zoom-out" title="Zoom Out">‚àí</button>
                <span class="mermaid-zoom-info" id="mermaid-zoom-info">100%</span>
                <button id="mermaid-zoom-in" title="Zoom In">+</button>
                <button id="mermaid-reset" title="Reset View">Reset</button>
                <button id="mermaid-maximize-window" title="Maximize Window">‚¨ú Window</button>
                <button id="mermaid-close" title="Close (ESC)">‚úï Close</button>
            </div>
        </div>
        <div class="mermaid-fs-content" id="mermaid-fs-content">
            <div class="mermaid-fs-wrapper" id="mermaid-fs-wrapper"></div>
        </div>
        <div class="mermaid-minimap" id="mermaid-minimap">
            <div class="mermaid-minimap-content" id="mermaid-minimap-content"></div>
            <div class="mermaid-minimap-viewport" id="mermaid-minimap-viewport"></div>
        </div>
    </div>
    <div class="mermaid-error-toast" id="mermaid-error-toast"></div>

    <!-- Graph View Overlay -->
    <div class="graph-overlay" id="graph-overlay">
        <div class="graph-header">
            <h3>Knowledge Graph</h3>
            <div class="graph-stats" id="graph-stats"></div>
            <button id="graph-close" title="Close (ESC)">‚úï Close</button>
        </div>
        <div class="graph-container" id="graph-container"></div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu" style="display: none;">
        <div class="context-menu-item" id="ctx-new-file">üìÑ New File</div>
        <div class="context-menu-item danger" id="ctx-delete">üóëÔ∏è Delete</div>
    </div>

    <!-- Vault Setup Dialog -->
    <div id="vault-setup-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-dialog vault-setup-dialog">
            <h2>Welcome to Obails</h2>
            <p>To get started, please select a folder containing your notes (Vault).</p>
            <div class="modal-actions">
                <button id="vault-setup-btn" class="primary-btn">Select Vault Folder</button>
            </div>
        </div>
    </div>

    <!-- Shortcuts Help Overlay -->
    <div id="shortcuts-overlay" class="shortcuts-overlay">
        <div class="shortcuts-content">
            <div class="shortcuts-header">
                <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
                <button id="shortcuts-close" class="shortcuts-close">‚úï</button>
            </div>
            <div class="shortcuts-body">
                <div class="shortcuts-section">
                    <h3>Global</h3>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd class="mod-key">‚åò</kbd> + <kbd>N</kbd></span>
                        <span class="shortcut-desc">New Note</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd class="mod-key">‚åò</kbd> + <kbd>P</kbd></span>
                        <span class="shortcut-desc">Quick Open (Search Files)</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd class="mod-key">‚åò</kbd> + <kbd>G</kbd></span>
                        <span class="shortcut-desc">Toggle Graph View</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd class="mod-key">‚åò</kbd> + <kbd>,</kbd></span>
                        <span class="shortcut-desc">Open Settings</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Shift</kbd> + <kbd>Tab</kbd></span>
                        <span class="shortcut-desc">Toggle File Tree / Editor</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Esc</kbd></span>
                        <span class="shortcut-desc">Close Overlays</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>?</kbd></span>
                        <span class="shortcut-desc">Show This Help</span>
                    </div>
                </div>
                <div class="shortcuts-section">
                    <h3>File Tree Navigation</h3>
                    <p class="shortcuts-hint">Press <kbd>Shift</kbd> + <kbd>Tab</kbd> to focus file tree first</p>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>j</kbd> / <kbd>k</kbd></span>
                        <span class="shortcut-desc">Move Down / Up</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>h</kbd></span>
                        <span class="shortcut-desc">Go to Parent Folder</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>l</kbd></span>
                        <span class="shortcut-desc">Open Folder</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Enter</kbd></span>
                        <span class="shortcut-desc">Open File / Toggle Folder</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Esc</kbd></span>
                        <span class="shortcut-desc">Unfocus File Tree</span>
                    </div>
                </div>
                <div class="shortcuts-section">
                    <h3>File Search</h3>
                    <p class="shortcuts-hint">Press <kbd class="mod-key">‚åò</kbd> + <kbd>P</kbd> to focus search first</p>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>N</kbd></span>
                        <span class="shortcut-desc">Select Next File</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>P</kbd></span>
                        <span class="shortcut-desc">Select Previous File</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Enter</kbd></span>
                        <span class="shortcut-desc">Open Selected File</span>
                    </div>
                    <div class="shortcut-row">
                        <span class="shortcut-keys"><kbd>Esc</kbd></span>
                        <span class="shortcut-desc">Clear Search / Blur</span>
                    </div>
                </div>
            </div>
            <div class="shortcuts-footer">
                Press <kbd>Esc</kbd> or <kbd>?</kbd> to close
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>
